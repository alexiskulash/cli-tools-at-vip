import {
  Split,
  Appear,
  Head,
  FullScreenCode,
  Image,
} from 'mdx-deck'
import { book as theTheme } from '@mdx-deck/themes'

export const theme = theTheme

import iterm from './images/iterm.png'

<Head>
  <title>CLI Tools at VIP</title>
</Head>


# CLI Tools at VIP

## Alexis Kulash

## Nick Daugherty

---

# CLI

## Command Line Interface

---

<blockquote>"...a means of interacting with a computer program where the user issues commands to the program in the form of successive lines of text."</blockquote>

---

# Why CLI?

---

<ul>
  <li>Control</li>
  <Appear>
    <li>Repeatable</li>
    <li>Automation</li>
    <li>Shareable</li>
    <li>Speed</li>
    <li>Development Speed</li>
  </Appear>
</ul>

---

# Game Plan

---

<ul>
  <Appear>
	<li>Basic Examples</li>
	<li>Shell Tricks</li>
	<li>`wp` CLI</li>
	<li>`vip` CLI</li>
  <li>`vipgo` CLI</li>
	<li>Q&A</li>
  </Appear>
</ul>

---

# Basic Examples

---

## List files

---

<FullScreenCode>

```bash
$ ls
```

</FullScreenCode>

---

<FullScreenCode>

```bash
$ ls
README.md		node_modules		now.json		package.json
deck.mdx		notes.md		package-lock.json	theme.js
```

</FullScreenCode>

---

# Arguments

---

<FullScreenCode>

```bash
$ ls content
```

</FullScreenCode>

---

<FullScreenCode>

```bash
$ ls content
camels.mp4	camels.txt	cats.gif	otters.jpg
```

</FullScreenCode>

---

# Exercise

List all the files on your desktop via CLI

---

# Options

---

<FullScreenCode>

```bash
$ ls -l content
```

</FullScreenCode>

---

<FullScreenCode>

```bash
$ ls -l content
total 11624
-rw-rw-rw-@ 1 vip  staff   431015 Oct 15 16:35 camels.mp4
-rw-r--r--  1 vip  staff    10155 Oct 15 16:55 camels.txt
-rw-rw-rw-@ 1 vip  staff  4693925 Oct 15 16:33 cats.gif
-rw-rw-rw-@ 1 vip  staff   141734 Oct 15 16:40 otters.jpg
```

</FullScreenCode>

---

<FullScreenCode>

```bash
$ ls -a content
```

</FullScreenCode>

---

<FullScreenCode>

```bash
$ ls -a content
.		..		.hidden-file	camels.mp4	camels.txt  cats.gif	otters.jpg
```

</FullScreenCode>

---

# Combining options

---

<FullScreenCode>

```bash
$ ls -la content
```

</FullScreenCode>

---

<FullScreenCode>

```bash
$ ls -la content
total 11624
drwxr-xr-x   6 vip  staff  192 Oct 15 16:28 .
drwxr-xr-x  13 vip  staff  416 Oct 15 16:27 ..
-rw-r--r--   1 vip  staff    0 Oct 15 16:28 .hidden-file
-rw-r--r--   1 vip  staff    0 Oct 15 16:26 camels.mp4
-rw-r--r--   1 vip  staff    10155 Oct 15 16:55 camels.txt
-rw-r--r--   1 vip  staff    0 Oct 15 16:26 cats.gif
-rw-r--r--   1 vip  staff    0 Oct 15 16:26 otters.jpg
```

</FullScreenCode>

---

## Sending output to a file

---

<FullScreenCode>

```bash
$ ls content > files.txt
```

</FullScreenCode>

---

## Where's my output???

---

<FullScreenCode>

```bash
$ cat files.txt
```

</FullScreenCode>

---

<FullScreenCode>

```bash
$ cat files.txt
camels.mp4
cats.gif
otters.jpg
```

</FullScreenCode>

---

## Reading input from a file

---

<FullScreenCode>

```bash
$ less < content/camels.txt
```

</FullScreenCode>

---

<FullScreenCode>

```bash
$ less < content/camels.txt
A camel is an even-toed ungulate...
:
```

</FullScreenCode>

---

<FullScreenCode>

```bash
$ less < content/camels.txt
A camel is an even-toed ungulate...
The word camel is derived via Latin
:
```

</FullScreenCode>

---

## Input from another command

---

<FullScreenCode>

```bash
$ cat content/camels.txt | less
```

</FullScreenCode>

---

<FullScreenCode>

```bash
$ cat content/camels.txt | less
A camel is an even-toed ungulate...
:
```

</FullScreenCode>

---

<FullScreenCode>

```bash
$ cat content/camels.txt | less
A camel is an even-toed ungulate...
The word camel is derived via Latin
:
```

</FullScreenCode>

---

## Building from another command

---

<FullScreenCode>

```bash
$ find content -name "*.mp4" | xargs -I % open %
```

</FullScreenCode>

---


<FullScreenCode>

```bash
$ find content -name "*.mp4" | xargs -tI % open %
```

</FullScreenCode>

---

# Shell Tricks

---

## Tab completion

Save typing with filename autocomplete

---

<FullScreenCode>

```bash
$ cat content/
```

</FullScreenCode>

---

<FullScreenCode>

```bash
$ cat content/
```

</FullScreenCode>

---

<FullScreenCode>

```bash
$ cat content/
.hidden-file  camels.mp4    camels.txt    cats.gif      otters.jpg
```

</FullScreenCode>

---

<FullScreenCode>

```bash
$ cat content/ca
```

</FullScreenCode>

---

<FullScreenCode>

```bash
$ cat content/ca
camels.mp4  camels.txt  cats.gif
```

</FullScreenCode>

---

<FullScreenCode>

```bash
$ cat content/camels.t
```

</FullScreenCode>

---

<FullScreenCode>

```bash
$ cat content/camels.txt
```

</FullScreenCode>

---

## History

Use up/down arrows to access previous commands

---

## man pages

## Manual pages with commmand info

---

<FullScreenCode>

```bash
$ man curl
```

</FullScreenCode>

---

## Multiple windows

---

<Image
  src={ iterm } />

---

# WP CLI

## Control WP from the command line

---

developer.wordpress.org/cli/commands

---

## Get sandboxed

---

<FullScreenCode>

```bash
$ vipgo sandbox start vip-test.go-vip.co
```

</FullScreenCode>

---

<FullScreenCode>

```bash
$ wp help
```

</FullScreenCode>

---

<FullScreenCode>

```bash
$ wp help

NAME

  wp

DESCRIPTION

  Manage WordPress through the command-line.

SYNOPSIS

  wp <command>

SUBCOMMANDS

  akismet                      Filter spam comments.
  cache                        Adds, removes, fetches, and flushes the WP Object Cache object.
  cap                          Adds, removes, and lists capabilities of a user role.
  cli                          Review current WP-CLI info, check for updates, or see defined aliases.
  co-authors-plus              Co-Authors Plus commands for the WP-CLI framework
:
```

</FullScreenCode>

---

<FullScreenCode>

```bash
$ wp help post
```

</FullScreenCode>

---

# Exercise

Save the ID and title of all posts as a CSV in post_ids.csv

---

# `wp post generate`

## Create new posts with dummy data

---

<FullScreenCode>

```bash
$ wp help post generate
```

</FullScreenCode>

---

## `wp user create`

---

## Create new users

---

<FullScreenCode>

```bash
$ wp help user create
```

</FullScreenCode>

---

# `wp site list`

---

## List all sites in a multisite environment

---

<FullScreenCode>

```bash
$ wp help site list
```

</FullScreenCode>

---

# Exercise

List the themes for each site on multisite-demo.go-vip.co using `xargs`

---

## `wp shell`

---

## Execute arbitrary PHP code

---

<FullScreenCode>

```bash
$ wp shell
```

</FullScreenCode>

---

<FullScreenCode>

```bash
$ wp shell
wp>
```

</FullScreenCode>

---

<FullScreenCode>

```bash
$ wp shell
wp> get_post( 2323 );
```

</FullScreenCode>

---

<FullScreenCode>

```bash
$ wp shell
wp> get_post( 2323 );
class WP_Post#3083 (24) {
  public $ID =>
  int(2323)
  public $post_author =>
  string(1) "0"
  public $post_date =>
  string(19) "1999-01-19 18:01:13"
  public $post_date_gmt =>
  string(19) "1970-01-01 00:00:00"
  public $post_content =>
```

</FullScreenCode>

---

# `vip` CLI

## Control VIP from the command line

---

## Run WP CLI without sandboxing

---

<FullScreenCode>

```bash
$ vip @297.testing -- wp post get 2323
```

</FullScreenCode>

---

## Pseudo-shell

---

<FullScreenCode>

```bash
$ vip @297.testing -- wp
```

</FullScreenCode>

---

<FullScreenCode>

```bash
$ vip @297.testing -- wp
Welcome to the WP CLI shell for the testing environment of vip-test (vip-test.go-vip.co)!
vip-test.testing:~$
```

</FullScreenCode>

---

<FullScreenCode>

```bash
$ vip @297.testing -- wp
Welcome to the WP CLI shell for the testing environment of vip-test (vip-test.go-vip.co)!
vip-test.testing:~$ wp post list
```

</FullScreenCode>

---

# Exercise

Using `vip`, get the value cached for the key `"alloptions"` in the `"options"` group on site 297 (vip-test.go-vip.co)

---

# `vipgo` CLI

## Control VIP from the command line

---

<FullScreenCode>

```bash
$ vipgo -h
```

</FullScreenCode>

---

<FullScreenCode>

```bash
$ vipgo api -h
```

</FullScreenCode>

---

## API Requests

---

<FullScreenCode>

```bash
$ vipgo api get "/sites?search=test&pagesize=3"
```

</FullScreenCode>

---

## Database Queries

---

<FullScreenCode>

```bash
$ vipgo db vip-test.go-vip.co
```

</FullScreenCode>

---

## Probes

---

<FullScreenCode>

```bash
$ vipgo probe memcached --container=42088
```

</FullScreenCode>

---

<FullScreenCode>

```bash
$ vipgo probe node --container=59291
```

</FullScreenCode>

---

<FullScreenCode>

```bash
$ vipgo probe list --type memcached --site 297
```

</FullScreenCode>

---

# Questions?